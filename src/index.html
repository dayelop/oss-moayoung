<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="assets/chat.png" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta name="description" content="@@description" />
    <meta name="keywords" content="@@keywords" />
    <title>Î™®ÏïÑÏòÅ</title>
    <!--title-->
    <meta property="og:title" content="@@title" />
    <meta property="og:description" content="@@description" />
    <meta property="og:image" content="@@image" />
    <script
      src="https://code.jquery.com/jquery-3.5.1.min.js"
      integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
      crossorigin="anonymous"
    ></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-analytics.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.1.1/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-2.1.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12"></script>
    <script src="assets/bundle.js?v=@@version"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"
      crossorigin="anonymous"
    ></script>

    <script>
      var prevRadio = null;
      var firstlip = true;
      var faceMesh = new FaceMesh({
        locateFile: (file) => {
          return `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${file}`;
        },
      });
      faceMesh.setOptions({
        maxNumFaces: 1,
        minDetectionConfidence: 0.5,
        minTrackingConfidence: 0.5,
      });
      var interval = null;
      function check(input) {
        var lips_area = document.getElementById('lips-area');

        if (input.checked == true) {
          lips_area.style.display = 'inline';
        } else {
          lips_area.style.display = 'none';
        }
      }

      function libSelect() {
        var checked_id = $(':input:radio[name=lipDetecting]:checked').val(); //1
        var canvas_ = document.getElementById(`${checked_id}`); //1
        const videoElement = document.getElementById('video-' + checked_id);

        const canvasCtx = canvas_.getContext('2d');

        function onResults(results) {
          if (
            $(document.getElementById('libMagnify')).prop('checked') == true
          ) {
            console.log('Ïò®Î¶¨Ï†àÌä∏ Îì§Ïñ¥Ïò¥');
            if (results.multiFaceLandmarks[0]) {
              canvasCtx.clearRect(0, 0, canvas_.width, canvas_.height);
              let lipwidth =
                results.multiFaceLandmarks[0][287].x -
                results.multiFaceLandmarks[0][57].x;

              let litheight =
                results.multiFaceLandmarks[0][18].y -
                results.multiFaceLandmarks[0][164].y;

              canvasCtx.drawImage(
                results.image,
                results.multiFaceLandmarks[0][57].x * videoElement.videoWidth,
                results.multiFaceLandmarks[0][164].y *
                  videoElement.videoHeight +
                  5,
                lipwidth * videoElement.videoWidth,
                litheight * videoElement.videoHeight,
                0,
                0,
                300,
                200
              );
              canvasCtx.restore();
            }
          }
        }

        faceMesh.onResults(onResults);
        if (interval != null) {
          console.log('„Öá„Öá');
          clearInterval(interval);
        }
        interval = setInterval(async () => {
          await faceMesh.send({ image: videoElement });
        }, 200);
        canvas_.style.display = 'inline'; //1

        if (prevRadio == null) {
          prevRadio = canvas_;
        } else if (prevRadio != canvas_) {
          prevRadio.style.display = 'none';
          prevRadio = canvas_;
        }
      }
    </script>
    <script>
      function saveAsFile(filename) {
        var hiddenElement = document.createElement('a');
        var str = $('.subtitles').text();
        hiddenElement.href = 'data:attachment/text,' + encodeURI(str);
        hiddenElement.target = '_blank';
        hiddenElement.download = filename;
        hiddenElement.click();
      }
    </script>
  </head>
  <body id="hotkey">
    <div class="container maincontainer">
      <div class="mainrow">
        <div class="" id="main" style="display: none">
          <div id="video-area">
            <div class="video-item" id="yourVideoArea">
              <div class="video-wrap">
                <!-- Video.ts -->
                <div class="video-inner-wrap">
                  <!-- Video.ts -->
                  <video
                    class="input_video"
                    id="yourVideo"
                    autoplay
                    muted
                    playsinline
                  ></video>
                  <!-- ÎπÑÎîîÏò§ -->
                </div>
              </div>
            </div>
            <div
              id="welcome"
              class="welcome-messages"
              v-bind:class="{'open': open}"
            >
              <!-- elements > welcome.ts-->
              <!-- #welcome -->
              <div class="welcome-inner">
                <span class="close fas fa-times" v-on:click="close"></span>
                <!-- welcome.tsÏóêÏÑú close Ìï®Ïàò -->
                <div class="invite row" v-bind:class="{'show': showInvite}">
                  <!-- elements > welcome.ts-->
                  <!-- <div class="col-xs-12 invite-header">{{inviteotherwithlink}}:</div>-->
                  <!-- elements > welcome.ts / translator.ts -> "Invite other with this link" Îî± Î∞© ÎßåÎì§Î©¥ ÎÇòÏò§Îäî ÏïåÎ¶ºÏ∞Ω -->
                  <div class="col-xs-12 invite-header">
                    ÏïÑÎûòÏùò ÎßÅÌÅ¨Î°ú Ï¥àÎåÄÌï¥Î≥¥ÏÑ∏Ïöî üòé
                  </div>
                  <div class="col-xs-12 invite-content">
                    <input
                      v-model="link"
                      readonly
                      type="text"
                      id="invite-link-welcome"
                    /><button
                      v-bind:class="{'fa-copy': !copied, 'fa-check': copied}"
                      v-on:click="copy"
                      class="fas"
                    ></button>
                  </div>
                </div>
                <div class="setname row" v-bind:class="{'show': showSetName}">
                  <div class="col-xs-12 setname-header">{{yournamelabel}}:</div>
                  <!-- elements > welcome.ts / Ï≤òÏùå Îì§Ïñ¥ÏôîÏùÑ Îïå Ïù¥Î¶Ñ ÏÑ§Ï†ï-->
                  <div class="col-xs-12 setname-content">
                    <input
                      v-model="name"
                      @blur="changeUserinfo"
                      autofocus
                      placeholder="..."
                      @keydown.enter.exact.prevent
                      @keyup.enter.exact="close"
                    />
                  </div>
                </div>
                <button
                  v-bind:class="{'show': showSetName}"
                  v-on:click="close"
                  type="submit"
                  data-lang="starting"
                  class="button starting"
                >
                  Starting
                </button>
                <div class="row"></div>
              </div>
            </div>
            <div id="lips-area"></div>
          </div>
          <div class="row center-xs" id="footer">
            <div class="col-xs-12" id="controls">
              <!-- ÎßàÏù¥ÌÅ¨, Ïπ¥Î©îÎùº, ÌôîÎ©¥ Í≥µÏú†, Ï±ÑÌåÖÏ∞Ω, ÌÜµÌôî ÏãúÏûë Î≤ÑÌäº -->
              <!-- controls.ts #controls-->
              <!-- css : ÏÜçÏÑ± -->
              <span
                v-on:click="toogleMicrophone"
                v-bind:class="{'fa-microphone': microphoneOn, 'fa-microphone-slash': !microphoneOn}"
                class="microphone fas fa-microphone"
              ></span>
              <span
                v-on:click="toogleCamera"
                v-bind:class="{'fa-video': cameraOn, 'fa-video-slash': !cameraOn}"
                class="camera fas fa-video"
              ></span>
              <span
                v-on:click="toogleScreen"
                v-bind:class="{'screenon': screenOn, 'disabled': screenSharingNotAllowed}"
                class="screen fas fa-desktop"
              ></span>
              <span
                v-on:click="toogleOption"
                v-bind:class="{'optionon': optionOn, 'newMessage': hasNewMessage}"
                class="option fas fa-bars"
              ></span>
              <span
                v-on:click="toogleOption"
                v-bind:class="{'optiononclose': optionOn}"
                class="optionclose fas fa-times"
              ></span>
              <span
                v-on:click="hangOut"
                v-bind:class="{'green': hangouted}"
                class="hangup fas fa-phone"
              ></span>
            </div>
          </div>
        </div>
        <div id="sidebar">
          <!-- optionÏ∞Ω ÎàåÎ†ÄÏùÑ Îïå ÏòÜÏóê Îú®Îäî Ï∞Ω -->
          <div class="tabs">
            <div class="tabs-header row">
              <div tab="partner" class="col-xs-3" data-lang="Ï∞∏Ïó¨Ïûê">
                Participant
              </div>
              <div tab="chat" class="col-xs-3" data-lang="Ï±ÑÌåÖ">Chat</div>
              <div
                tab="subtitle"
                class="col-xs-3"
                data-lang="ÏûêÎßâ"
                id="testTitle"
              >
                Subtitle
              </div>
              <div tab="settings" class="col-xs-3" data-lang="ÏÑ§Ï†ï">
                Setting
              </div>
            </div>
            <div class="tabs-content">
              <!-- tab ÌïòÎÇò ÌïòÎÇò -->
              <div id="tab-partner">
                <!-- participant Ï∞Ω  -->
                <div id="invite" class="row">
                  <!-- <div class="col-xs-12 invite-header">{{inviteotherwithlink}}:</div> -->
                  <div class="col-xs-12 invite-header">
                    ÏïÑÎûòÏùò ÎßÅÌÅ¨Î°ú Ï¥àÎåÄÌï¥Î≥¥ÏÑ∏Ïöî üòé
                  </div>
                  <div class="col-xs-12 invite-content">
                    <input
                      v-model="link"
                      readonly
                      type="text"
                      id="invite-link"
                    /><button
                      v-bind:class="{'fa-copy': !copied, 'fa-check': copied}"
                      v-on:click="copy"
                      class="fas"
                    ></button>
                  </div>
                </div>
                <div id="partnerlist">
                  <ul></ul>
                </div>
              </div>
              <div id="tab-chat">
                <div id="textchat">
                  <!-- Ï±ÑÌåÖÏ∞Ω TextChat.ts #textchat-->
                  <div class="msger">
                    <div class="msger-chat"></div>
                    <div
                      class="msger-extrainfo"
                      v-bind:class="{'hidden': !extrainfoVisible}"
                    >
                      <span v-html="extrainfo"></span>
                      <span
                        class="close fas fa-times"
                        v-on:click="closeExtra"
                      ></span>
                    </div>
                    <div
                      class="msger-emoji-area"
                      v-bind:class="{'hidden': !emojiVisible}"
                    >
                      <span
                        class="close fas fa-times"
                        v-on:click="toogleEmoji"
                      ></span>
                    </div>
                    <form
                      class="msger-inputarea"
                      v-on:submit.prevent="sendMessage"
                    >
                      <textarea
                        v-model="message"
                        type="text"
                        class="msger-input"
                        placeholder="ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî."
                        style="font-family: 'S-CoreDream-5Medium'"
                        @paste="addfilebypast"
                        @keydown.enter.exact.prevent
                        @keyup.enter.exact="sendMessage"
                      ></textarea>
                      <label
                        class="msger-emoji fas fa-grin-alt"
                        @click="toogleEmoji"
                      ></label>
                      <label class="msger-imgupload fas fa-file-image">
                        <input type="file" accept="image/*" @change="addfile" />
                      </label>
                      <button
                        type="submit"
                        class="msger-send-btn fas fa-paper-plane"
                      ></button>
                    </form>
                  </div>
                </div>
              </div>
              <div id="tab-subtitle">
                <button
                  class="subtitle-button"
                  type="button"
                  onclick="saveAsFile('ÏûêÎßâ.txt');"
                >
                  ÏûêÎßâ ÌååÏùº Îã§Ïö¥Î°úÎìú
                </button>
                <p class="subtitles"></p>
              </div>
              <div id="tab-settings">
                <!-- ÏÑ§Ï†ïÏ∞Ω : Ïù¥Î¶Ñ, ÎßàÏù¥ÌÅ¨ .. Îì±-->
                <div id="userinfo">
                  <!-- Ïù¥Î¶Ñ ÏÑ§Ï†ï -->
                  <div class="row">
                    <!-- <label class="col-xs-6" >{{namelabel}}:</label> -->
                    <label class="col-xs-6">Ïù¥Î¶Ñ</label>
                    <input
                      class="col-xs-6"
                      v-model="name"
                      @blur="changeUserinfo"
                      placeholder="..."
                    />
                  </div>
                </div>
                <div id="devices">
                  <!-- ÎßàÏù¥ÌÅ¨ ÏÑ§Ï†ï -->
                  <div class="row">
                    <!-- <label class="col-xs-6" >{{microphonelabel}}:</label> -->
                    <label class="col-xs-6">ÎßàÏù¥ÌÅ¨</label>
                    <select
                      class="col-xs-6"
                      v-model="audio"
                      @change="onChange()"
                    >
                      <option
                        v-for="(option, index) in audiooptions"
                        :key="index"
                        v-bind:value="index"
                      >
                        {{ option }}
                      </option>
                    </select>
                  </div>
                  <div class="row">
                    <!-- ÎπÑÎîîÏò§ ÏÑ§Ï†ï -->
                    <!-- <label class="col-xs-6" >{{videolabel}}:</label> -->
                    <label class="col-xs-6">Ïπ¥Î©îÎùº</label>
                    <select
                      class="col-xs-6"
                      v-model="video"
                      @change="onChange()"
                    >
                      <option
                        v-for="(option, index) in videooptions"
                        :key="index"
                        v-bind:value="index"
                      >
                        {{ option }}
                      </option>
                    </select>
                  </div>
                  <div
                    class="row sound"
                    v-bind:class="{'allowed': soundAllowed}"
                  >
                    <!-- Ïä§ÌîºÏª§ ÏÑ§Ï†ï -->
                    <!-- <label class="col-xs-6" >{{speakerlabel}}:</label> -->
                    <label class="col-xs-6">Ïä§ÌîºÏª§</label>
                    <select
                      class="col-xs-6"
                      v-model="sound"
                      @change="onChange()"
                    >
                      <option
                        v-for="(option, index) in soundoptions"
                        :key="index"
                        v-bind:value="index"
                      >
                        {{ option }}
                      </option>
                    </select>
                  </div>
                </div>
                <div id="configuration" v-if="soundEffectsEnabled">
                  <div class="row" v-if="soundEffectsEnabled">
                    <label class="col-xs-6">{{soundeffectsLabel}}:</label>
                    <input
                      type="checkbox"
                      v-model="soundEffectsOn"
                      @change="toogleSoundEffects"
                    />
                  </div>
                </div>
                <div id="settingSwitch">
                  <!-- Ìé∏Ïùò Í∏∞Îä• Ï†úÏñ¥ -->
                  <div class="switchbox">
                    <p>ÏñºÍµ¥ Î≤óÏñ¥ÎÇ® Í∞êÏßÄ</p>
                    <label class="switch">
                      <input type="checkbox" id="faceDetect" />
                      <span class="slider round"></span>
                    </label>
                  </div>
                  <div class="switchbox">
                    <p>ÏûêÎßâ Ï∂îÏ∂ú</p>
                    <label class="switch">
                      <input type="checkbox" id="subtitleExtract" />
                      <span class="slider round"></span>
                    </label>
                  </div>
                  <div class="switchbox">
                    <p>Î∞úÌôîÏûê ÏûÖ ÌôïÎåÄ</p>
                    <label class="switch">
                      <input
                        type="checkbox"
                        id="libMagnify"
                        onclick="check(this)"
                      />
                      <span class="slider round"></span>
                    </label>
                  </div>
                  <div class="switchbox">
                    <p>Ï∞∏Ïó¨Ïûê ÏùåÏÑ± ÏïåÎ¶º</p>
                    <label class="switch">
                      <input type="checkbox" id="participantAlarm" />
                      <span class="slider round"></span>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div id="clickbackground"></div>
      </div>
    </div>
    <div
      id="lightbox"
      v-on:dblclick="closeLightbox"
      v-bind:class="{'open': !closed}"
    >
      <img
        id="lightboxImageElement"
        :src="src"
        v-bind:class="{'active': mode == 'image'}"
      />
      <video
        id="lightboxVideoElement"
        controls
        autoplay
        :src="src"
        v-bind:class="{'active': mode == 'video'}"
      ></video>
      <span class="close fas fa-times" v-on:click="closeLightbox"></span>
    </div>
    <div id="create-room" v-bind:class="{'show': showDialog}">
      <!-- Î∞© ÎßåÎìúÎäî Ï∞Ω -->
      <div class="create-room-inner" v-bind:class="{'show': showInner}">
        <form v-on:submit.prevent="openWaitroom">
          <div class="title" style="text-align: center">Î™®ÏïÑÏòÅ</div>
          <div class="message" style="text-align: center">
            ÌÜµÌôîÎ∞© Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÍ≥†,<br />
            ÌÜµÌôîÎ∞©ÏùÑ Í∞úÏÑ§Ìï¥Î≥¥ÏÑ∏Ïöî ‚ùï
          </div>
          <div class="room-input">
            <!-- Î∞© Ïù¥Î¶Ñ Ïì∞Îäî Ïπ∏ -->
            <input
              autofocus
              id="room-name"
              type="text"
              v-model="roomName"
              @keydown.enter.exact.prevent
              @keyup.enter.exact="createRoom"
            />
            <button
              type="button"
              v-on:click="setRandomName"
              class="fas fa-random"
            ></button>
          </div>
          <div class="button-area">
            <button
              type="submit"
              data-lang="ÎåÄÍ∏∞Î∞©"
              class="button"
              v-on:click="openWaitroom"
            >
              Create
            </button>
          </div>
        </form>
      </div>
      <!-- ÎåÄÍ∏∞Î∞© -->
      <div id="waitroom" v-bind:class="{'show': showWaitroom}">
        <div>
          <form>
            ÏÇ¨Ïö©Ïûê Ïù¥Î¶Ñ
            <input class="name-input" />
          </form>
        </div>

        <div id="waitroomControls">
          <div class="waitroomVideoDiv" v-bind:class="{'show': cameraOn}">
            <video
              id="waitroomVideo"
              autoplay
              muted
              playsinline
              v-bind:class="{'show': cameraOn}"
              style="width: 800px; height: 700px"
            ></video>
          </div>

          <div class="waitroomVideoDiv" v-bind:class="{'show': !cameraOn}">
            <div class="cameraOff">
              <p>camera off</p>
            </div>
          </div>

          <div>
            <span
              v-on:click="toogleMicrophone"
              v-bind:class="{'fa-microphone': microphoneOn, 'fa-microphone-slash': !microphoneOn}"
              class="microphone fas fa-microphone"
            >
            </span>
            <span
              v-on:click="toogleCamera"
              v-bind:class="{'fa-video': cameraOn, 'fa-video-slash': !cameraOn}"
              class="camera fas fa-video"
            >
            </span>
          </div>
        </div>

        <div>
          <form v-on:submit.prevent="createRoom" style="display: inline-block">
            <button
              style="
                border-width: 0px;
                background: transparent;
                position: fixed;
                top: 82.5%;
                right: 20.5%;
              "
            >
              <span
                v-on:click="openWaitroom"
                v-bind:class="{'green': hangouted}"
                class="hangup fas fa-phone"
              >
              </span>
            </button>
          </form>
        </div>
      </div>
    </div>
  </body>
</html>
